<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Cloud Notepad (GitHub)</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 24px;
  max-width: 900px;
}
textarea {
  width: 100%;
  height: 320px;
  margin-top: 12px;
  font-family: monospace;
  font-size: 14px;
}
input, button {
  padding: 8px;
  margin: 4px 0;
}
button {
  margin-right: 6px;
}
.status {
  margin-top: 12px;
  padding: 8px;
  border-radius: 4px;
  display: none;
}
.success { background: #e6ffed; color: #055d20; }
.error { background: #ffe6e6; color: #8a0000; }
</style>
</head>

<body>

<h2>Web-Based Cloud Notepad</h2>

<label>
  File name:
  <input id="filename" placeholder="notes.txt">
</label>

<br>

<button onclick="loadFile()">Load</button>
<button onclick="saveFile()">Save</button>
<button onclick="clearText()">Clear</button>

<textarea id="editor" placeholder="Write here..."></textarea>

<div id="status" class="status"></div>

<script>
/* ================= CONFIG ================= */

const GITHUB_OWNER = "Ymichaelluisfelasol-tech";
const GITHUB_REPO  = "web-base-notepad";
const GITHUB_TOKEN = "ghp_YOUR_TOKEN_HERE";
const BRANCH = "main";

const API = "https://api.github.com";

/* ============== UTILITIES ================= */

function setStatus(msg, error=false) {
  const el = document.getElementById("status");
  el.textContent = msg;
  el.className = "status " + (error ? "error" : "success");
  el.style.display = "block";
}

function ghHeaders() {
  return {
    "Authorization": `Bearer ${GITHUB_TOKEN}`,
    "Accept": "application/vnd.github+json",
    "Content-Type": "application/json"
  };
}

/* ============== LOAD FILE ================= */

async function loadFile() {
  const filename = document.getElementById("filename").value.trim();
  if (!filename) {
    setStatus("File name required", true);
    return;
  }

  try {
    const res = await fetch(
      `${API}/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${filename}?ref=${BRANCH}`,
      { headers: ghHeaders() }
    );

    if (res.status === 404) {
      setStatus("File not found", true);
      return;
    }

    if (!res.ok) throw new Error(await res.text());

    const data = await res.json();
    const content = atob(data.content.replace(/\n/g, ""));

    const editor = document.getElementById("editor");
    editor.value = content;
    editor.dataset.sha = data.sha;

    setStatus("File loaded");
  } catch (e) {
    setStatus("Load failed: " + e.message, true);
  }
}

/* ============== SAVE FILE ================= */

async function saveFile() {
  const filename = document.getElementById("filename").value.trim();
  const editor = document.getElementById("editor");

  if (!filename) {
    setStatus("File name required", true);
    return;
  }

  const body = {
    message: `Update ${filename}`,
    content: btoa(unescape(encodeURIComponent(editor.value))),
    branch: BRANCH,
    committer: {
      name: "Cloud Notepad",
      email: "notepad@example.com"
    }
  };

  if (editor.dataset.sha) {
    body.sha = editor.dataset.sha;
  }

  try {
    const res = await fetch(
      `${API}/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${filename}`,
      {
        method: "PUT",
        headers: ghHeaders(),
        body: JSON.stringify(body)
      }
    );

    if (!res.ok) throw new Error(await res.text());

    const data = await res.json();
    editor.dataset.sha = data.content.sha;

    setStatus("File saved");
  } catch (e) {
    setStatus("Save failed: " + e.message, true);
  }
}

/* ============== CLEAR ================= */

function clearText() {
  const editor = document.getElementById("editor");
  editor.value = "";
  editor.dataset.sha = "";
  setStatus("Editor cleared");
}
</script>

</body>
</html>
